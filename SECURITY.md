# Security / Safety Policy

macdiet はストレージ削減を扱うため、誤操作がデータ損失につながり得ます。この文書は「危険操作をどう扱うか」を明文化します。

## リスクレベル

- R0: 診断のみ（既定）
- R1: ユーザー領域の安全寄りな掃除（原則 `~/.Trash` への移動）
- R2: 再生成可能でも影響が出得る（Docker/Simulator整理など）。明示確認が必須
- R3: スナップショット thin/delete 等。影響が大きく、慎重な運用が必要（sudoが必要になる場合あり）

## 破壊操作の原則

- dry-run が既定（`--apply` が無い限り変更しない）
- ホワイトリスト対象のみを実行（パス/種別/所有者などで限定）
- 直接削除（unlink）は原則禁止。Trash移動を基本とする
- 非TTY（パイプ/リダイレクト）では対話を禁止し、危険操作は失敗させる

## 現状（v0.1）

- `fix --apply` は R1/TRASH_MOVE のみ対応（TTY+明示確認必須）
- R2 の実行は未対応（診断・導線のみ）
- R3 は `snapshots thin/delete` を限定対応（TTY+二段階確認、sudoは自動化しない、deleteは検出してUUIDへ一意に解決できるIDのみ受理）

## 脆弱性・安全上の問題の報告

安全上の問題（ホワイトリスト回避、誤削除につながる経路、対話ゲートの欠落等）を見つけた場合は、Issue で再現手順と期待/実際の挙動を共有してください。
